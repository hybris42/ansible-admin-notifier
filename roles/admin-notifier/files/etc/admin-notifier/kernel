#! /bin/bash

if [ $# -ne 1 ]; then
    echo "usage: kernel NOTIFICATION_SERVICE"
    exit 1
fi

loaded_kernel=$(uname -r)
last_kernel=$(ls -tr /boot/vmlinuz-* | tail -n1 | sed 's|/boot/vmlinuz-||')

if [ x${loaded_kernel} != x${last_kernel} ]; then
    message="Loaded kernel is ${loaded_kernel}, ${last_kernel} is installed, reboot asap"

    /usr/local/bin/admin-notifier $1 NewKernelAvailable "$(hostname)" kernel "${message}"
fi
